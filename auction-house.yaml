openapi: 3.1.1
info:
  title: "Auction API"
  description: "API specification for the auction platform"
  version: "1"
  license:
    name: "GPL-3.0-only"
    url: "https://opensource.org/license/gpl-3-0"

servers:
  - url: "http://localhost:8080/"
    description: Local Development

tags:
  - name: Auctions
    description: Auction management endpoints. From the perspective of an auctioneer.
  - name: Bidders
    description: Bidder management endpoints. From the prespective of a bidder.

paths:
  /auctions:
    get:
      tags:
        - Auctions
      summary: Retrieve open auctions
      description: Retrieve a list of all open auctions from this group
      parameters:
        - $ref: '#/components/parameters/ApiVersion'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  auctions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Auction'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auctions/{auctionId}:
    get:
      tags:
        - Auctions
      summary: Retrieve auction
      description: Retrieve one auction
      parameters:
        - $ref: '#/components/parameters/ApiVersion'
        - name: auctionId
          in: path
          required: true
          description: Unique identifier of the auction
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Auction'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /auctions/{auctionId}/job:
    post:
      tags:
        - Auctions
      summary: Job executed
      description: The bid for a specific auction was won. The auctionId is specified in the request body
      parameters:
        - $ref: '#/components/parameters/ApiVersion'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Job'
      responses:
        '201':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /auctions/{auctionId}/bid:
    post:
      tags:
        - Auctions
      summary: Place bid for auction
      description: Place a new bid for the specified auction. The auctionId is specified in the request body.
      parameters:
        - $ref: '#/components/parameters/ApiVersion'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Bid'
      responses:
        '201':
          description: Bid placed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Bid'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /bidders:
    post:
      tags:
        - Bidders
      summary: Auction started
      description: Notification from other group that a new auction started
      parameters:
        - $ref: '#/components/parameters/ApiVersion'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Auction'
      responses:
        '201':
          description: Auction created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Auction'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /bidders/{auctionId}/job:
    post:
      tags:
        - Bidders
      summary: Bid for auction won
      description: The bid for a specific auction was won. The auctionId is specified in the request body
      parameters:
        - $ref: '#/components/parameters/ApiVersion'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Job'
      responses:
        '201':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  parameters:
    ApiVersion:
      name: X-API-Version
      in: header
      required: true
      description: API version
      schema:
        type: string
        example: "1"
  
  schemas:
    Auction:
      type: object
      required:
        - status
        - auctionId
        - auctionHouseUri
        - jobType
        - deadline
      properties:
        status:
          type: string
          enum: [OPEN, CLOSED]
          description: Current status of the auction
        auctionId:
          type: string
          format: uuid
          description: ID of the auction, used to reference it in further requests
          example: 83a6bdbd-dcf5-43ad-a476-5d43de8285ea
        auctionHouseUri:
          type: string
          format: uri
          description: URI of the auction house hosting the auction
          example: "http://group12.pitas.scs.unisg.ch:8080/"
        jobType:
          type: string
          description: JobType for the auction
        deadline:
          type: string
          format: date-time
          description: Deadline for bidding in this auction
          example: "2025-11-30T16:42:12.69Z"

    Bid:
      type: object
      required:
        - auctionId
        - bidderName
        - bidderAuctionHouseUri
      properties:
        auctionId:
          type: string
          format: uuid
          description: ID of the auction this bid is for
          example: 83a6bdbd-dcf5-43ad-a476-5d43de8285ea
        bidderName:
          type: string
          description: Name of the bidding group
          example: "group42"
        bidderAuctionHouseUri:
          type: string
          format: uri
          description: URI of the bidders auction house, used to assign job

    Job:
      type: object
      required:
        - auctionId
        - auctionHouseUri
        - jobType
        - status
      properties:
        auctionId:
          type: string
          format: uuid
          description: ID of the auction this job is from
          example: 83a6bdbd-dcf5-43ad-a476-5d43de8285ea
        auctionHouseUri:
          type: string
          format: uri
          description: URI of the auction house hosting the auction
          example: "http://group12.pitas.scs.unisg.ch:8080/"
        jobType:
          type: string
          description: Job type
        status:
          type: string
          enum: [OPEN, EXECUTED, FAILED]
        inputData:
          type: string
          description: Optional input data for job
        outputData:
          type: string
          description: "Result of job: result of job if status EXECUTED, error message if status FAILED"
    
    Error:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
        details:
          type: object
          description: Additional error details

  responses:
    BadRequest:
      description: Bad request - invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "Invalid input data"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "Resource not found"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: "An unexpected error occurred"
